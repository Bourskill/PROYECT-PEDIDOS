<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Navegación Dinámica con Flechas y Responsividad</title>
  <style>
    #container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .item {
      border: 1px solid #ccc;
      padding: 20px;
      cursor: pointer;
      outline: none;
      flex-basis: 45%; /* Los elementos ocupan el 45% del contenedor en pantallas grandes */
      box-sizing: border-box;
    }

    .item.selected {
      background-color: #007BFF;
      color: white;
    }

    /* Responsividad: en pantallas pequeñas apilar los elementos en una columna */
    @media (max-width: 600px) {
      .item {
        flex-basis: 100%; /* Los elementos ocupan todo el ancho en pantallas pequeñas */
      }
    }

    /* En pantallas grandes (a partir de 601px), los elementos se apilan de a 2 por fila */
    @media (min-width: 601px) {
      #container {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2 columnas de tamaño igual para 4 elementos */
        gap: 10px;
      }

      .item {
        flex-basis: auto; /* Quitar el flex-basis cuando usemos grid */
      }
    }
  </style>
</head>
<body>

  <div id="container">
    <div class="item" tabindex="0">Elemento 1</div>
    <div class="item" tabindex="0">Elemento 2</div>
    <div class="item" tabindex="0">Elemento 3</div>
    <div class="item" tabindex="0">Elemento 4</div>
  </div>

  <script>
    document.addEventListener('keydown', function (event) {
      const items = document.querySelectorAll('.item');
      const selectedItem = document.querySelector('.item.selected');
      let index = selectedItem ? Array.from(items).indexOf(selectedItem) : -1;

      // Calcular el número de columnas (dependiendo del ancho de la pantalla)
      const containerWidth = document.getElementById('container').offsetWidth;
      const itemWidth = items[0].offsetWidth;
      const columns = Math.floor(containerWidth / itemWidth);

      // Comprobar si la pantalla es pequeña (máximo 600px de ancho)
      const isSmallScreen = window.innerWidth <= 600;

      // Si estamos en una pantalla pequeña, solo permitimos la navegación vertical
      if (isSmallScreen) {
        if (event.key === 'ArrowDown') {
          if (index + 1 < items.length) {
            index += 1; // Mover al siguiente elemento en la columna
          }
        } 
        else if (event.key === 'ArrowUp') {
          if (index - 1 >= 0) {
            index -= 1; // Mover al anterior en la columna
          }
        }
      } else {
        // Navegación en pantallas grandes (también horizontal)
        if (event.key === 'ArrowDown') {
          if (index + columns < items.length) {
            index += columns; // Mover al siguiente elemento en la columna
          }
        } 
        else if (event.key === 'ArrowUp') {
          if (index - columns >= 0) {
            index -= columns; // Mover al anterior en la columna
          }
        } 
        else if (event.key === 'ArrowRight') {
          if ((index + 1) % columns !== 0 && index + 1 < items.length) {
            index += 1; // Mover al siguiente elemento de la fila
          }
        } 
        else if (event.key === 'ArrowLeft') {
          if (index % columns !== 0 && index - 1 >= 0) {
            index -= 1; // Mover al anterior de la fila
          }
        }
      }

      // Deseleccionar con Escape
      if (event.key === 'Escape') {
        items.forEach(item => item.classList.remove('selected'));
        return;
      }

      // Asegurarse que el índice esté dentro del rango
      if (index >= 0 && index < items.length) {
        items.forEach(item => item.classList.remove('selected'));
        items[index].classList.add('selected');
        items[index].focus();
      }
    });

    // Inicializar la selección del primer elemento
    document.querySelectorAll('.item')[0].classList.add('selected');
    document.querySelectorAll('.item')[0].focus();
  </script>

</body>
</html>
